from flask import Flask, request, jsonify

app = Flask(__name__)

# Your menu reply logic
def get_reply(message, contact_name=None):
    message = message.strip()
    if message == "1":
        return f"Hi {contact_name or ''}, Book your session here: https://yourbookinglink.com"
    elif message == "2":
        return f"Hi {contact_name or ''}, View our pricing here: https://yourpricinglink.com"
    elif message == "3":
        return f"Hi {contact_name or ''}, Talk to our customer service: +6012xxxxxxx"
    elif message == "4":
        return f"Hi {contact_name or ''}, See our FAQs here: https://yourfaqlink.com"
    else:
        return ("Hi üëã Welcome to BC! How can we help you today? Reply with the number below üëá\n"
                "1Ô∏è‚É£ Book a session\n"
                "2Ô∏è‚É£ View pricing\n"
                "3Ô∏è‚É£ Talk to customer service\n"
                "4Ô∏è‚É£ FAQs")

@app.route("/webhook", methods=["POST"])
def webhook():
    data = request.json

    # Extract top-level keys from Wabot payload
    sender_phone = data.get("from")
    user_message = data.get("message")
    
    # Optional: child key for personalization
    contact_name = data.get("contact", {}).get("name")

    # Determine reply
    reply_message = get_reply(user_message, contact_name)

    # Respond back to Wabot
    response = {
        "phone": sender_phone,
        "message": reply_message
    }

    return jsonify(response), 200

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)
